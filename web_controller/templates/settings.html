{% extends "base.html" %}

{% block title %}Settings - H.Airbrush Controller{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">Settings</h1>
            
            <!-- Connection Settings -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Connection Settings</h5>
                </div>
                <div class="card-body">
                    <form id="connection-form">
                        <div class="mb-3">
                            <label for="duet-host" class="form-label">Duet Host</label>
                            <input type="text" class="form-control" id="duet-host" value="192.168.1.1">
                            <div class="form-text">IP address or hostname of the Duet 2 WiFi board</div>
                        </div>
                        <div class="mb-3">
                            <label for="duet-port" class="form-label">Telnet Port</label>
                            <input type="number" class="form-control" id="duet-port" value="23">
                            <div class="form-text">Telnet port for G-code streaming (default: 23)</div>
                        </div>
                        <div class="mb-3">
                            <label for="duet-http-port" class="form-label">HTTP Port</label>
                            <input type="number" class="form-control" id="duet-http-port" value="80">
                            <div class="form-text">HTTP port for status monitoring (default: 80)</div>
                        </div>
                        <div class="mb-3">
                            <label for="connection-timeout" class="form-label">Connection Timeout</label>
                            <input type="number" class="form-control" id="connection-timeout" value="5">
                            <div class="form-text">Connection timeout in seconds</div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Connection Settings</button>
                        <button type="button" id="test-connection" class="btn btn-outline-secondary">Test Connection</button>
                    </form>
                </div>
            </div>
            
            <!-- Machine Settings -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Machine Settings</h5>
                </div>
                <div class="card-body">
                    <form id="machine-form">
                        <h6 class="mb-3">Working Area</h6>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="max-x" class="form-label">Max X (mm)</label>
                                <input type="number" class="form-control" id="max-x" value="300">
                            </div>
                            <div class="col-md-4">
                                <label for="max-y" class="form-label">Max Y (mm)</label>
                                <input type="number" class="form-control" id="max-y" value="300">
                            </div>
                            <div class="col-md-4">
                                <label for="max-z" class="form-label">Max Z (mm)</label>
                                <input type="number" class="form-control" id="max-z" value="50">
                            </div>
                        </div>
                        
                        <h6 class="mb-3">Movement Settings</h6>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="default-feedrate" class="form-label">Default Feedrate (mm/min)</label>
                                <input type="number" class="form-control" id="default-feedrate" value="1000">
                            </div>
                            <div class="col-md-4">
                                <label for="z-feedrate" class="form-label">Z Feedrate (mm/min)</label>
                                <input type="number" class="form-control" id="z-feedrate" value="500">
                            </div>
                            <div class="col-md-4">
                                <label for="travel-height" class="form-label">Travel Height (mm)</label>
                                <input type="number" class="form-control" id="travel-height" value="10">
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Machine Settings</button>
                    </form>
                </div>
            </div>
            
            <!-- Brush Settings -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Brush Settings</h5>
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs" id="brushTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="brush-a-tab" data-bs-toggle="tab" data-bs-target="#brush-a-pane" type="button" role="tab">Brush A (Black)</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="brush-b-tab" data-bs-toggle="tab" data-bs-target="#brush-b-pane" type="button" role="tab">Brush B (White)</button>
                        </li>
                    </ul>
                    <div class="tab-content mt-3" id="brushTabsContent">
                        <div class="tab-pane fade show active" id="brush-a-pane" role="tabpanel">
                            <form id="brush-a-form">
                                <h6 class="mb-3">Brush A Configuration</h6>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="brush-a-offset-x" class="form-label">X Offset (mm)</label>
                                        <input type="number" class="form-control" id="brush-a-offset-x" value="0">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="brush-a-offset-y" class="form-label">Y Offset (mm)</label>
                                        <input type="number" class="form-control" id="brush-a-offset-y" value="0">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="brush-a-air-pin" class="form-label">Air Control Pin</label>
                                    <input type="number" class="form-control" id="brush-a-air-pin" value="0">
                                    <div class="form-text">Pin number for air control (M42 P0)</div>
                                </div>
                                <div class="mb-3">
                                    <label for="brush-a-paint-servo" class="form-label">Paint Control Servo</label>
                                    <input type="number" class="form-control" id="brush-a-paint-servo" value="0">
                                    <div class="form-text">Servo index for paint control (M280 P0)</div>
                                </div>
                                <div class="mb-3">
                                    <label for="brush-a-paint-angle" class="form-label">Paint Servo Angle</label>
                                    <input type="number" class="form-control" id="brush-a-paint-angle" value="90">
                                    <div class="form-text">Servo angle for paint on (0-180)</div>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Brush A Settings</button>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="brush-b-pane" role="tabpanel">
                            <form id="brush-b-form">
                                <h6 class="mb-3">Brush B Configuration</h6>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="brush-b-offset-x" class="form-label">X Offset (mm)</label>
                                        <input type="number" class="form-control" id="brush-b-offset-x" value="50">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="brush-b-offset-y" class="form-label">Y Offset (mm)</label>
                                        <input type="number" class="form-control" id="brush-b-offset-y" value="50">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="brush-b-air-pin" class="form-label">Air Control Pin</label>
                                    <input type="number" class="form-control" id="brush-b-air-pin" value="1">
                                    <div class="form-text">Pin number for air control (M42 P1)</div>
                                </div>
                                <div class="mb-3">
                                    <label for="brush-b-paint-servo" class="form-label">Paint Control Servo</label>
                                    <input type="number" class="form-control" id="brush-b-paint-servo" value="1">
                                    <div class="form-text">Servo index for paint control (M280 P1)</div>
                                </div>
                                <div class="mb-3">
                                    <label for="brush-b-paint-angle" class="form-label">Paint Servo Angle</label>
                                    <input type="number" class="form-control" id="brush-b-paint-angle" value="90">
                                    <div class="form-text">Servo angle for paint on (0-180)</div>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Brush B Settings</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Advanced Settings -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Advanced Settings</h5>
                </div>
                <div class="card-body">
                    <form id="advanced-form">
                        <div class="mb-3">
                            <label for="command-timeout" class="form-label">Command Timeout (s)</label>
                            <input type="number" class="form-control" id="command-timeout" value="10">
                            <div class="form-text">Timeout for G-code command execution</div>
                        </div>
                        <div class="mb-3">
                            <label for="status-interval" class="form-label">Status Update Interval (ms)</label>
                            <input type="number" class="form-control" id="status-interval" value="500">
                            <div class="form-text">Interval for status updates in milliseconds</div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="debug-mode">
                            <label class="form-check-label" for="debug-mode">Enable Debug Mode</label>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Advanced Settings</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Load settings from server
        loadSettings();
        
        // Set up form submissions
        document.getElementById('connection-form').addEventListener('submit', function(e) {
            e.preventDefault();
            saveConnectionSettings();
        });
        
        document.getElementById('machine-form').addEventListener('submit', function(e) {
            e.preventDefault();
            saveMachineSettings();
        });
        
        document.getElementById('brush-a-form').addEventListener('submit', function(e) {
            e.preventDefault();
            saveBrushSettings('brush_a');
        });
        
        document.getElementById('brush-b-form').addEventListener('submit', function(e) {
            e.preventDefault();
            saveBrushSettings('brush_b');
        });
        
        document.getElementById('advanced-form').addEventListener('submit', function(e) {
            e.preventDefault();
            saveAdvancedSettings();
        });
        
        // Test connection button
        document.getElementById('test-connection').addEventListener('click', testConnection);
    });
    
    function loadSettings() {
        // In a real implementation, this would fetch settings from the server
        // For now, we'll use default values already in the form
        console.log('Loading settings...');
        
        // Simulate a successful load
        setTimeout(function() {
            console.log('Settings loaded');
        }, 500);
    }
    
    function saveConnectionSettings() {
        const settings = {
            duet_host: document.getElementById('duet-host').value,
            duet_port: parseInt(document.getElementById('duet-port').value),
            duet_http_port: parseInt(document.getElementById('duet-http-port').value),
            connection_timeout: parseInt(document.getElementById('connection-timeout').value)
        };
        
        console.log('Saving connection settings:', settings);
        
        // In a real implementation, this would send settings to the server
        // For now, just show an alert
        alert('Connection settings saved');
    }
    
    function saveMachineSettings() {
        const settings = {
            max_x: parseFloat(document.getElementById('max-x').value),
            max_y: parseFloat(document.getElementById('max-y').value),
            max_z: parseFloat(document.getElementById('max-z').value),
            default_feedrate: parseFloat(document.getElementById('default-feedrate').value),
            z_feedrate: parseFloat(document.getElementById('z-feedrate').value),
            travel_height: parseFloat(document.getElementById('travel-height').value)
        };
        
        console.log('Saving machine settings:', settings);
        
        // In a real implementation, this would send settings to the server
        // For now, just show an alert
        alert('Machine settings saved');
    }
    
    function saveBrushSettings(brush) {
        const prefix = brush === 'brush_a' ? 'brush-a' : 'brush-b';
        
        const settings = {
            offset_x: parseFloat(document.getElementById(`${prefix}-offset-x`).value),
            offset_y: parseFloat(document.getElementById(`${prefix}-offset-y`).value),
            air_pin: parseInt(document.getElementById(`${prefix}-air-pin`).value),
            paint_servo: parseInt(document.getElementById(`${prefix}-paint-servo`).value),
            paint_angle: parseInt(document.getElementById(`${prefix}-paint-angle`).value)
        };
        
        console.log(`Saving ${brush} settings:`, settings);
        
        // In a real implementation, this would send settings to the server
        // For now, just show an alert
        alert(`${brush.replace('_', ' ')} settings saved`);
    }
    
    function saveAdvancedSettings() {
        const settings = {
            command_timeout: parseInt(document.getElementById('command-timeout').value),
            status_interval: parseInt(document.getElementById('status-interval').value),
            debug_mode: document.getElementById('debug-mode').checked
        };
        
        console.log('Saving advanced settings:', settings);
        
        // In a real implementation, this would send settings to the server
        // For now, just show an alert
        alert('Advanced settings saved');
    }
    
    function testConnection() {
        const host = document.getElementById('duet-host').value;
        const port = document.getElementById('duet-port').value;
        
        console.log(`Testing connection to ${host}:${port}...`);
        
        // Simulate connection test
        setTimeout(function() {
            // In a real implementation, this would actually test the connection
            // For now, just show a success message
            alert(`Successfully connected to ${host}:${port}`);
        }, 1000);
    }
</script>
{% endblock %} 